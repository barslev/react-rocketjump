(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{108:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return b}));var i=n(3),r=n(7),o=(n(0),n(123)),a={id:"api_composition",title:"RocketJump Composition",sidebar_label:"Composition",slug:"/api-composition"},c={unversionedId:"api_composition",id:"version-2.x/api_composition",isDocsHomePage:!1,title:"RocketJump Composition",description:"RocketJumps can be merged!",source:"@site/versioned_docs/version-2.x/api_composition.md",slug:"/api-composition",permalink:"/react-rocketjump/docs/api-composition",editUrl:"https://github.com/inmagik/react-rocketjump/edit/master/website/versioned_docs/version-2.x/api_composition.md",version:"2.x",sidebar_label:"Composition",sidebar:"version-2.x/someSidebar",previous:{title:"Sharing configuration",permalink:"/react-rocketjump/docs/api-config"},next:{title:"Mutations",permalink:"/react-rocketjump/docs/api-mutations"}},l=[{value:"How does composition work?",id:"how-does-composition-work",children:[{value:"Different composition strategies",id:"different-composition-strategies",children:[]},{value:"Merged properties",id:"merged-properties",children:[]},{value:"Overwrite properties",id:"overwrite-properties",children:[]}]}],p={toc:l};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(i.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"RocketJumps can be merged!"),Object(o.b)("p",null,"As stated in the initial part of the API description, the ",Object(o.b)("inlineCode",{parentName:"p"},"rj")," constructor can take several arguments, each of which can be the result of a previous call (provided that the ",Object(o.b)("inlineCode",{parentName:"p"},"effect")," property was not set), a provided plugin, or a configuration object. Calling ",Object(o.b)("inlineCode",{parentName:"p"},"rj")," with several arguments is interpreted as a composition will."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const rj1 = rj({ /* config 1 */ })\n\nconst rj2 = rj({ /* config 2 */ })\n\nconst __GENERATED__ = rj(\n  rj1,\n  rj2,\n  {/* last config */ },\n)\n")),Object(o.b)("h2",{id:"how-does-composition-work"},"How does composition work?"),Object(o.b)("p",null,"Consider the following example"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const rj0 = rj({ /* config R */ });\nconst rj1 = rj(rj0, { /* config O */ });\nconst rj2 = rj({ /* config C */ });\nconst final = rj(rj1, rj2, { /* config K */ });\n")),Object(o.b)("p",null,"The composition order goes from top to bottom and from left to right. Hence, in our example, we have the following composition order: ",Object(o.b)("inlineCode",{parentName:"p"},"config R > config O > config C > config K"),"."),Object(o.b)("h3",{id:"different-composition-strategies"},"Different composition strategies"),Object(o.b)("p",null,"Due to the wide variety of available configuration properties, it is not possible to define a global composition strategy. Instead, we can describe some composition strategies which describe how different properties are composed"),Object(o.b)("h4",{id:"chain-properties"},"Chain properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Chain properties are ",Object(o.b)("em",{parentName:"p"},"actions")," and ",Object(o.b)("em",{parentName:"p"},"selectors"))),Object(o.b)("p",null,"Chain properties are so called because they are functions that are invoked in chain (i.e. the output of the previous one is the input of the second one) in composition order at composition time. The argument of the first call is the default value. At the end, the RocketJump Object will contain only the output of the last call."),Object(o.b)("p",null,"In our example, let's pretend that all the four config objects (R, O, C, K) define the ",Object(o.b)("em",{parentName:"p"},"actions")," property. Composition works like this:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the default action bag is generated"),Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configR")," is called with the default action bag as parameter, and its output merged with the default action bag to produce ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag1")),Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configO")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag1")," as parameter, and its output is merged with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag1")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag2")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configC")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag2")," as parameter, and its output is merged with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag2")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag3")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configK")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag3")," as parameter, and its output is merged with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag3")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag4")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag4")," is the final action bag")),Object(o.b)("h4",{id:"recursive-properties"},"Recursive properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Recursive properties are ",Object(o.b)("em",{parentName:"p"},"reducer"),", (",Object(o.b)("em",{parentName:"p"},"composeReducer"),"), ",Object(o.b)("em",{parentName:"p"},"effectCaller"))),Object(o.b)("p",null,"Recursive properties are so called because they involve runtime function composition: the final value is a function which is the mathematical composition of the functions defined in the merged configurations in composition order."),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"composeReducer")," here is put in parenthesis because it is not involved directly in composition, being squashed onto the ",Object(o.b)("em",{parentName:"p"},"reducer")," property before composition starts (i.e. with respect to composition, there is no ",Object(o.b)("em",{parentName:"p"},"composeReducer")," property, but only ",Object(o.b)("em",{parentName:"p"},"reducer"),", which contains also all the composed reducers)"),Object(o.b)("p",null,"Let's pretend that all the four config objects (R, O, C, K) define the ",Object(o.b)("em",{parentName:"p"},"reducer")," property. Composition works like this:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the default reducer is generated"),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming the default reducer as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configR")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer1")),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer1")," as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configO")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer2")),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer2")," as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configC")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer3")),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer3")," as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configK")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer4")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"tempReducer4")," is the final reducer")),Object(o.b)("p",null,"Let's pretend that all the four config objects (R, O, C, K) define the ",Object(o.b)("em",{parentName:"p"},"effectCaller")," property. Composition works like this:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the default effectCaller is generated"),Object(o.b)("li",{parentName:"ul"},"when the user triggers an effect run, the following things happen:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," specified in ",Object(o.b)("inlineCode",{parentName:"li"},"configR")," is called, with its ",Object(o.b)("inlineCode",{parentName:"li"},"effect")," argument set to a fake effect function"),Object(o.b)("li",{parentName:"ul"},"when the fake effect function is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args"),", the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," set in ",Object(o.b)("inlineCode",{parentName:"li"},"configO")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args")," and with a second fake effect function"),Object(o.b)("li",{parentName:"ul"},"when this second fake effect function is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args"),", the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," set in ",Object(o.b)("inlineCode",{parentName:"li"},"configC")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args")," and with a third fake effect function"),Object(o.b)("li",{parentName:"ul"},"when this third fake effect function is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args"),", the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," set in ",Object(o.b)("inlineCode",{parentName:"li"},"configK")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args")," and with a the default effect caller as its ",Object(o.b)("inlineCode",{parentName:"li"},"effect")," parameter")))),Object(o.b)("h3",{id:"merged-properties"},"Merged properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Merged property is only ",Object(o.b)("em",{parentName:"p"},"computed"))),Object(o.b)("p",null,"Merged properties are merged using plain object assignment in composition order"),Object(o.b)("h3",{id:"overwrite-properties"},"Overwrite properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Overwrite properties are ",Object(o.b)("em",{parentName:"p"},"takeEffect"),", ",Object(o.b)("em",{parentName:"p"},"name"))),Object(o.b)("p",null,"Overwrite properties are not merged, the last configuration in composition order defining it wins"))}b.isMDXComponent=!0},123:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var i=n(0),r=n.n(i);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),b=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},s=function(e){var t=b(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,a=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),s=b(n),d=i,u=s["".concat(a,".").concat(d)]||s[d]||m[d]||o;return n?r.a.createElement(u,c(c({ref:t},p),{},{components:n})):r.a.createElement(u,c({ref:t},p))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:i,a[1]=c;for(var p=2;p<o;p++)a[p]=n[p];return r.a.createElement.apply(null,a)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);