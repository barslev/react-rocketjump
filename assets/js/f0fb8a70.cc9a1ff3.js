(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{129:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return r})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var i=n(3),o=(n(0),n(133));const a={id:"plugin_system",title:"Plugin System",sidebar_label:"Plugin System",slug:"/plugin-system"},r={unversionedId:"plugin_system",id:"plugin_system",isDocsHomePage:!1,title:"Plugin System",description:"RocketJump help you reusing you RjObject logic using an advanced plugin system.",source:"@site/docs/plugin_system.md",slug:"/plugin-system",permalink:"/react-rocketjump/docs/next/plugin-system",editUrl:"https://github.com/inmagik/react-rocketjump/edit/master/website/docs/plugin_system.md",version:"current",sidebar_label:"Plugin System",sidebar:"someSidebar",previous:{title:"Consume RjObjects",permalink:"/react-rocketjump/docs/next/consume-rj-objects"},next:{title:"Builder Mode",permalink:"/react-rocketjump/docs/next/builder-mode"}},c=[{value:"Your first plugin",id:"your-first-plugin",children:[]},{value:"Compose plugins",id:"compose-plugins",children:[]},{value:"How does composition work?",id:"how-does-composition-work",children:[{value:"Different composition strategies",id:"different-composition-strategies",children:[]},{value:"Merged properties",id:"merged-properties",children:[]},{value:"Overwrite properties",id:"overwrite-properties",children:[]},{value:"<code>addSideEffect</code>",id:"addsideeffect",children:[]}]}],l={toc:c};function p({components:e,...t}){return Object(o.b)("wrapper",Object(i.a)({},l,t,{components:e,mdxType:"MDXLayout"}),Object(o.b)("p",null,"RocketJump help you reusing you RjObject logic using an advanced plugin system."),Object(o.b)("p",null,"You can use write your own plugins ore use some good plugins provided by the library."),Object(o.b)("p",null,"To write a RocketJump plugin you should use the ",Object(o.b)("inlineCode",{parentName:"p"},"rjPlugin")," function, it accepts\nthe same parameters of ",Object(o.b)("inlineCode",{parentName:"p"},"rj")," function except for ",Object(o.b)("inlineCode",{parentName:"p"},"effect"),", ",Object(o.b)("inlineCode",{parentName:"p"},"mutations")," and ",Object(o.b)("inlineCode",{parentName:"p"},"computed"),"\ntheese options are only allowed in the ",Object(o.b)("inlineCode",{parentName:"p"},"rj")," functions."),Object(o.b)("p",null,"To use a plugin pass them to the ",Object(o.b)("inlineCode",{parentName:"p"},"rj")," function before the config object."),Object(o.b)("h2",{id:"your-first-plugin"},"Your first plugin"),Object(o.b)("p",null,"Try to explain the concepts above with a basic example. ",Object(o.b)("br",null),"\nYou a write a simple RjObject to handle a todo list:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rj } from 'react-rocketjump'\n\nconst TodosState = rj({\n  mutations: {\n    addTodo: {\n      effect: (todo) =>\n        fetch(`/todos/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(todo),\n        }).then((r) => r.json()),\n      updater: (state, newTodo) => ({\n        ...state,\n        data: state.data.concat(newTodo),\n      }),\n    },\n  },\n  effect: () => fetch(`/todos`).then((r) => r.json()),\n})\n")),Object(o.b)("p",null,"You have to write another RjObject to handle for example a list of users.\nYou notify that the ",Object(o.b)("inlineCode",{parentName:"p"},"updater")," to append new a item to a list of todos or user\nis the same."),Object(o.b)("p",null,"First, extract updater logic to an action creator an handle them with ",Object(o.b)("inlineCode",{parentName:"p"},"composeReducer"),":"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rj } from 'react-rocketjump'\n\nconst TodosState = rj({\n  actions: () => ({\n    insertItem: (item) => ({ type: 'APPEND', payload: item }),\n  }),\n  composeReducer: (state, action) => {\n    if (action.type === 'APPEND') {\n      return state.data.concat(action.payload)\n    }\n    return state\n  },\n  mutations: {\n    addTodo: {\n      effect: (todo) =>\n        fetch(`/todos/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(todo),\n        }).then((r) => r.json()),\n      updater: 'insertItem',\n    },\n  },\n  effect: () => fetch(`/todos`).then((r) => r.json()),\n})\n")),Object(o.b)("p",null,"Now it's time to make it reausable extract it as a RocketJump Plugin!"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rj, rjPlugin } from 'react-rocketjump'\n\n// Define plugin\nconst appendPlugin = rjPlugin({\n  actions: () => ({\n    insertItem: (item) => ({ type: 'APPEND', payload: item }),\n  }),\n  composeReducer: (state, action) => {\n    if (action.type === 'APPEND') {\n      return state.data.concat(action.payload)\n    }\n    return state\n  },\n})\n\n// Use it to make your RjObject\nconst TodosState = rj(appendPlugin, {\n  mutations: {\n    addTodo: {\n      effect: (todo) =>\n        fetch(`/todos/`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(todo),\n        }).then((r) => r.json()),\n      updater: 'insertItem',\n    },\n  },\n  effect: () => fetch(`/todos`).then((r) => r.json()),\n})\n")),Object(o.b)("p",null,"Now everytime you need to insert an item you can your awesome ",Object(o.b)("inlineCode",{parentName:"p"},"appendPlugin"),"!"),Object(o.b)("h2",{id:"compose-plugins"},"Compose plugins"),Object(o.b)("p",null,"One of the wonderful property about plugins is that you can compose them.\nFor example you are very entusiast about plugins and you also write\nthe ",Object(o.b)("inlineCode",{parentName:"p"},"removePlugin")," to remove an item from a list and the ",Object(o.b)("inlineCode",{parentName:"p"},"updatePlugin")," to update\nan time from a list.\nYou can use all of them with the ",Object(o.b)("inlineCode",{parentName:"p"},"rj")," function:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rj } from 'react-rocketjump'\nimport { appendPlugin, removePlugin, updatePlugin } from './myPlugins'\n\nconst MyObj = rj(appendPlugin, removePlugin, updatePlugin, {\n  // ... Your config ...\n})\n")),Object(o.b)("p",null,"Or you can compose plugin toghter and make an unique plugin!"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rjPlugin } from 'react-rocketjump'\n\nconst listOperatiosPlugin = rjPlugin(appendPlugin, removePlugin, updatePlugin, {\n  // ...You eventual config for listOperatiosPlugin plugin...\n})\n\n// NOTE: This is equal to the example above\nconst MyObj = rj(listOperatiosPlugin, {\n  // ... Your config ...\n})\n")),Object(o.b)("p",null,"You can compose plugin togher with no limitations, only you fantasy is the limit!"),Object(o.b)("h2",{id:"how-does-composition-work"},"How does composition work?"),Object(o.b)("p",null,"Consider the following example"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"const p0 = rjPlugin({ /* config R */ });\nconst p1 = rjPlugin(p0, { /* config O */ });\nconst p2 = rjPlugin({ /* config C */ });\nconst final = rj(p1, p2, { /* config K */ });\n")),Object(o.b)("p",null,"The composition order goes from top to bottom and from left to right. Hence, in our example, we have the following composition order: ",Object(o.b)("inlineCode",{parentName:"p"},"config R > config O > config C > config K"),"."),Object(o.b)("h3",{id:"different-composition-strategies"},"Different composition strategies"),Object(o.b)("p",null,"Due to the wide variety of available configuration properties, it is not possible to define a global composition strategy. Instead, we can describe some composition strategies which describe how different properties are composed"),Object(o.b)("h4",{id:"chain-properties"},"Chain properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Chain properties are ",Object(o.b)("em",{parentName:"p"},"actions")," , ",Object(o.b)("em",{parentName:"p"},"selectors"),", ",Object(o.b)("em",{parentName:"p"},"effectPipeline"))),Object(o.b)("p",null,"Chain properties are so called because they are functions that are invoked in chain (i.e. the output of the previous one is the input of the second one) in composition order at composition time. The argument of the first call is the default value. At the end, the RocketJump Object will contain only the output of the last call."),Object(o.b)("p",null,"In our example, let's pretend that all the four config objects (R, O, C, K) define the ",Object(o.b)("em",{parentName:"p"},"actions")," property. Composition works like this:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the default action bag is generated"),Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configR")," is called with the default action bag as parameter, and its output merged with the default action bag to produce ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag1")),Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configO")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag1")," as parameter, and its output is merged with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag1")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag2")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configC")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag2")," as parameter, and its output is merged with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag2")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag3")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("em",{parentName:"li"},"actions")," transform of ",Object(o.b)("inlineCode",{parentName:"li"},"configK")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag3")," as parameter, and its output is merged with ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag3")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag4")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"tempActionBag4")," is the final action bag")),Object(o.b)("h4",{id:"recursive-properties"},"Recursive properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Recursive properties are ",Object(o.b)("em",{parentName:"p"},"reducer"),", (",Object(o.b)("em",{parentName:"p"},"composeReducer"),"), ",Object(o.b)("em",{parentName:"p"},"effectCaller"))),Object(o.b)("p",null,"Recursive properties are so called because they involve runtime function composition: the final value is a function which is the mathematical composition of the functions defined in the merged configurations in composition order."),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"composeReducer")," here is put in parenthesis because it is not involved directly in composition, being squashed onto the ",Object(o.b)("em",{parentName:"p"},"reducer")," property before composition starts (i.e. with respect to composition, there is no ",Object(o.b)("em",{parentName:"p"},"composeReducer")," property, but only ",Object(o.b)("em",{parentName:"p"},"reducer"),", which contains also all the composed reducers)"),Object(o.b)("p",null,"Let's pretend that all the four config objects (R, O, C, K) define the ",Object(o.b)("em",{parentName:"p"},"reducer")," property. Composition works like this:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the default reducer is generated"),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming the default reducer as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configR")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer1")),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer1")," as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configO")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer2")),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer2")," as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configC")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer3")),Object(o.b)("li",{parentName:"ul"},"a new reducer is created by transforming ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer3")," as stated in ",Object(o.b)("inlineCode",{parentName:"li"},"configK")," to create ",Object(o.b)("inlineCode",{parentName:"li"},"tempReducer4")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"tempReducer4")," is the final reducer")),Object(o.b)("p",null,"Let's pretend that all the four config objects (R, O, C, K) define the ",Object(o.b)("em",{parentName:"p"},"effectCaller")," property. Composition works like this:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"the default effectCaller is generated"),Object(o.b)("li",{parentName:"ul"},"when the user triggers an effect run, the following things happen:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," specified in ",Object(o.b)("inlineCode",{parentName:"li"},"configR")," is called, with its ",Object(o.b)("inlineCode",{parentName:"li"},"effect")," argument set to a fake effect function"),Object(o.b)("li",{parentName:"ul"},"when the fake effect function is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args"),", the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," set in ",Object(o.b)("inlineCode",{parentName:"li"},"configO")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args")," and with a second fake effect function"),Object(o.b)("li",{parentName:"ul"},"when this second fake effect function is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args"),", the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," set in ",Object(o.b)("inlineCode",{parentName:"li"},"configC")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args")," and with a third fake effect function"),Object(o.b)("li",{parentName:"ul"},"when this third fake effect function is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args"),", the ",Object(o.b)("inlineCode",{parentName:"li"},"effectCaller")," set in ",Object(o.b)("inlineCode",{parentName:"li"},"configK")," is called with ",Object(o.b)("inlineCode",{parentName:"li"},"...args")," and with a the default effect caller as its ",Object(o.b)("inlineCode",{parentName:"li"},"effect")," parameter")))),Object(o.b)("h3",{id:"merged-properties"},"Merged properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Merged property is only ",Object(o.b)("em",{parentName:"p"},"combineReducers"))),Object(o.b)("p",null,"Merged properties are merged using plain object assignment in composition order."),Object(o.b)("h3",{id:"overwrite-properties"},"Overwrite properties"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Overwrite properties are ",Object(o.b)("em",{parentName:"p"},"takeEffect"),", ",Object(o.b)("em",{parentName:"p"},"name"))),Object(o.b)("p",null,"Overwrite properties are not merged, the last configuration in composition order defining it wins."),Object(o.b)("h3",{id:"addsideeffect"},Object(o.b)("inlineCode",{parentName:"h3"},"addSideEffect")),Object(o.b)("p",null,"Finaly ",Object(o.b)("inlineCode",{parentName:"p"},"addSideEffect")," collect the list of result Observables using the composition\norder describe above and finally create an unique\nObservable using the RxJS ",Object(o.b)("a",{parentName:"p",href:"https://rxjs.dev/api/index/function/merge"},"merge function"),"."))}p.isMDXComponent=!0},133:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var i=n(0),o=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=o.a.createContext({}),s=function(e){var t=o.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=s(e.components);return o.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(n),m=i,d=b["".concat(r,".").concat(m)]||b[m]||u[m]||a;return n?o.a.createElement(d,c(c({ref:t},p),{},{components:n})):o.a.createElement(d,c({ref:t},p))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:i,r[1]=c;for(var p=2;p<a;p++)r[p]=n[p];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);