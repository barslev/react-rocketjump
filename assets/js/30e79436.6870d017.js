(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{124:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return b}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=a.a.createContext({}),f=function(e){var t=a.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=f(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},m=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),s=f(n),m=r,b=s["".concat(c,".").concat(m)]||s[m]||p[m]||o;return n?a.a.createElement(b,i(i({ref:t},u),{},{components:n})):a.a.createElement(b,i({ref:t},u))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var u=2;u<o;u++)c[u]=n[u];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},82:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return f}));var r=n(3),a=n(7),o=(n(0),n(124)),c={id:"effect_caller",title:"Effect Caller",sidebar_label:"Effect Caller",slug:"/effect-caller"},i={unversionedId:"effect_caller",id:"effect_caller",isDocsHomePage:!1,title:"Effect Caller",description:"We have learned how side effects works in the RocketJump world but sometimes",source:"@site/docs/effect_caller.md",slug:"/effect-caller",permalink:"/react-rocketjump/docs/next/effect-caller",editUrl:"https://github.com/inmagik/react-rocketjump/edit/master/website/docs/effect_caller.md",version:"current",sidebar_label:"Effect Caller",sidebar:"someSidebar",previous:{title:"Side Effects",permalink:"/react-rocketjump/docs/next/side-effects"},next:{title:"Consume RjObjects",permalink:"/react-rocketjump/docs/next/consume-rj-objects"}},l=[{value:"Configure effect inside React",id:"configure-effect-inside-react",children:[]},{value:"Real world authentication example",id:"real-world-authentication-example",children:[]}],u={toc:l};function f(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"We have learned how side effects works in the RocketJump world but sometimes\nyou need to hook into the effect to add some logic on top of it.",Object(o.b)("br",null),'\nA tipical example is the authentication, your authentication logic can live\noutside of RocketJump but you need to "inject" it in RocketJump effect. ',Object(o.b)("br",null),"\nFor this purpose RocketJump provided a way to hook into a generic effect the\n",Object(o.b)("inlineCode",{parentName:"p"},"effectCaller")," option.\nThe effect caller option take an effect and the params passed to it and should\nreturn the same values an effect return: Promise or Observable.\nLet's see an example to clarify the concept, now we add a retry features to our\nRjObject."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rj } from 'react-rocketjump'\n\nrj({\n  effectCaller: (effectFn, ...params) =>\n    effectFn(...params).catch(() => effectFn(...params)),\n  // ..\n})\n")),Object(o.b)("p",null,"Note this example is only for teaching purpose you can do better to implement\na retry system, but you can see that the effect caller take the effect, call\nit with given params and if fails try to re call it."),Object(o.b)("h2",{id:"configure-effect-inside-react"},"Configure effect inside React"),Object(o.b)("p",null,"Effect caller is useful but most of the time the state you need in the effect\ncaller live in the React context.\nRocketJump provide a way to this this, the first step is to set the ",Object(o.b)("inlineCode",{parentName:"p"},"effectCaller"),"\nas ",Object(o.b)("inlineCode",{parentName:"p"},"'configured'"),":"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},"import { rj } from 'react-rocketjump'\n\nrj({\n  effectCaller: 'configured',\n  // ..\n})\n")),Object(o.b)("p",null,"The second step is to use a component called ",Object(o.b)("inlineCode",{parentName:"p"},"<ConfigureRj />")," up in your React\ntree."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},"import { ConfigureRj } from 'react-rocketjump'\n\nexport const App = () => (\n  <ConfigureRj effectCaller={(effectFn, ...params) => {\n    /** Your effect caller **/*\n  }}>\n    {/** Your App React Tree **/}\n  </ConfigureRj>\n)\n")),Object(o.b)("p",null,"The most inner ",Object(o.b)("inlineCode",{parentName:"p"},"effectCaller")," from ",Object(o.b)("inlineCode",{parentName:"p"},"<ConfigureRj />")," in the React tree\nwill be used as acutal effect caller when you set it as ",Object(o.b)("inlineCode",{parentName:"p"},"configured"),"."),Object(o.b)("h2",{id:"real-world-authentication-example"},"Real world authentication example"),Object(o.b)("p",null,"Let's see a real world authentication example. For this example we use\na library from Inmagik family called ",Object(o.b)("a",{parentName:"p",href:"https://github.com/inmagik/use-eazy-auth"},"eazy auth"),".\nThis library provide a simple way to add authentication to your React app.",Object(o.b)("br",null),"\nThe libary give you a function called ",Object(o.b)("inlineCode",{parentName:"p"},"callAuthApiObservable")," to inject\nthe auth flow inside a generic function you can easy integrate it with RocketJump:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},"import { ConfigureRj, rj, useRunRj } from 'react-rocketjump'\nimport { useAuthActions } from 'use-eazy-auth'\nimport { login, me, refresh } from './authApis'\n\nconst Todos = rj({\n  effectCaller: 'configured',\n  effect: (token) => () =>\n    fetch(`/api/todos/`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    }).then((res) => (res.ok ? res.json() : Promise.reject(res))),\n})\n\nexport default function Dashboard() {\n  const [{ data: todos }] = useRunRj(Todos)\n  // ...\n}\n\nfunction ConfigureAuth({ children }) {\n  const { callAuthApiObservable } = useAuthActions()\n  return (\n    <ConfigureRj effectCaller={callAuthApiObservable}>{children}</ConfigureRj>\n  )\n}\n\nfunction App() {\n  return (\n    <Auth loginCall={login} meCall={me} refreshTokenCall={refresh}>\n      <ConfgureAuth>\n        <Dashboard />\n      </ConfgureAuth>\n    </Auth>\n  )\n}\n")))}f.isMDXComponent=!0}}]);