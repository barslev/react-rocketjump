<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Mutations · React-RocketJump</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;generalities&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#generalities&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Generalities&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Mutations · React-RocketJump"/><meta property="og:type" content="website"/><meta property="og:url" content="https://inmagik.github.io/react-rocketjump/"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;generalities&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#generalities&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Generalities&lt;/h2&gt;
"/><meta property="og:image" content="https://inmagik.github.io/react-rocketjump/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://inmagik.github.io/react-rocketjump/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/react-rocketjump/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/react-rocketjump/js/scrollSpy.js"></script><link rel="stylesheet" href="/react-rocketjump/css/main.css"/><script src="/react-rocketjump/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/react-rocketjump/"><h2 class="headerTitle">React-RocketJump</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/react-rocketjump/docs/installation" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/react-rocketjump/docs/api_rj" target="_self">API</a></li><li class=""><a href="https://www.github.com/inmagik/react-rocketjump" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>API | Defining</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Why React-RocketJump?<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/motivation">Motivation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/quickstart">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/concepts">General concepts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API | Defining<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/api_rj">RocketJump constructor</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/api_configure">Sharing configuration</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/api_composition">Composition</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/react-rocketjump/docs/api_mutations">Extension: mutations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API | Connecting<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/connect_generalities">Generalities</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/connect_userunrj">useRunRj</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/connect_userj">useRj</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/connect_connectrj">connectRj</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API | Using<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/usage_state">Working with state</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/usage_actions">Working with actions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API | Plugins<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_all">Introduction</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_list">List Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_plain_list">PlainList Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_list_insert">ListInsert Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_list_update">ListUpdate Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_list_delete">ListDelete Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_map">Map Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_debounce">Debounce Plugin</a></li><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/plugin_writing">Writing Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API | Debug<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/debug_logger">Logger</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tips &amp; Tricks<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-rocketjump/docs/tips_and_tricks">Custom hooks</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Mutations</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="generalities"></a><a href="#generalities" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generalities</h2>
<p>Mutations are a way to easily combine multiple side-effectful operation working on the same data. For instance, when we deal with a REST resource, it's highly recommended to keep the representation of your resource in a single state and to update it with mutations, that in turn map to HTTP verbs.</p>
<p>There are solutions to problems of this kind even without mutations (for instance, a possible solution is <a href="/react-rocketjump/docs/tips_and_tricks">this</a>), but using mutations allows you to better group conceptually related functionalities together, to keep your application state clean, and to use a declarative pattern.</p>
<p>A mutation is essentially defined by two elements:</p>
<ul>
<li>the effect to run (<em>effect</em>)</li>
<li>the logic to update the shared state given the result of the effect (<em>updater</em>)</li>
</ul>
<p>Then we can add some accessory elements:</p>
<ul>
<li>some logic used to invoke the effect (<em>effectCaller</em>)</li>
<li>some logic used to keep a mutation state (for instance, to track when the effect is running) (<em>reducer</em>)</li>
<li>some logic used to describe what to do when multiple runs of a mutation are asked by user (<em>takeEffect</em>)</li>
</ul>
<p>Given this, React RocketJump can create a full mutation workflow:</p>
<ol>
<li>For each mutation, a special RocketJump Action is created and injected in the action bag</li>
<li>Calling the injected action causes the <em>effectCaller</em> to be invoked</li>
<li>The <em>effectCaller</em> is in turn expected to invoke the <em>effect</em></li>
<li>As long as the <em>effect</em> proceeds, some plain actions can be intercepted by the <em>reducer</em>, if defined</li>
<li>When the <em>effect</em> resolves successfully, the <em>updater</em> is called with the previous state and the <em>effect</em> result in order to compute the next state</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="defining-mutations"></a><a href="#defining-mutations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining mutations</h2>
<p>Mutations can be defined for a RocketJump Object by adding a <em>mutations</em> configuration property as a sibling of the <em>effect</em> property. The <em>mutations</em> property contains an Object whose property names are mutation names, and the corresponding values are mutation descriptors, like this</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> SomeRjObject = rj({
    <span class="hljs-attr">effect</span>: <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> fetchPlayerById(id),
    <span class="hljs-attr">mutations</span>: {
        <span class="hljs-attr">update</span>: UpdateMutationDescriptor,
        <span class="hljs-attr">ban</span>: BanMutationDescriptor,
        <span class="hljs-attr">reward</span>: RewardMutationDescriptor,
        ...
    }
})
</code></pre>
<p>A mutation descriptor is nothing more than a plain JavaScript object with some configuration in. In the following, we are going to describe all the available configuration options</p>
<h3><a class="anchor" aria-hidden="true" id="effect"></a><a href="#effect" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>effect</h3>
<p><code>(...args) =&gt; Promise | (...args) =&gt; Observable</code></p>
<p>The <code>effect</code> configuration describes the side effect performed by the mutation: this can be any function you wish, provided that you return a <code>Promise</code> or an <code>Observable</code> provided by <a href="https://rxjs-dev.firebaseapp.com/">rxJS</a>. The rest is up to you.</p>
<p>Parameters of the function you pass are in principle up to you: you are free to define them as you wish, but please note that some other configuration properties (like <em>effectCaller</em>) may influence the way parameters are passed to your function.</p>
<h3><a class="anchor" aria-hidden="true" id="updater"></a><a href="#updater" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>updater</h3>
<p><code>string | (state: Object, effectResult: Object) =&gt; Object</code></p>
<p>The <code>updater</code> configuration property describes how to update the shared state given the result of a run of the mutation: each time the mutation completes, this function is called to reconcile the state. In order to write it properly, you must have a knowledge of the state shape. The default state shape in React RocketJump is</p>
<pre><code class="hljs css language-js">{
    <span class="hljs-attr">data</span>: <span class="hljs-comment">/* result of the last successful (main) effect run */</span>,
    <span class="hljs-attr">error</span>: <span class="hljs-comment">/* error of the last rejected (main) effect run */</span>,
    <span class="hljs-attr">pending</span>: <span class="hljs-comment">/* bool telling if the (main) effect is running */</span>,
}
</code></pre>
<p>where with <em>main</em> effect is the one defined in the configuration object, not that defined in the mutation. Anyway, remember that you can change it by setting a <em>reducer</em> property on your configuration, or by using some plugin, or again by extending some RocketJump Partials, ... Summing up, refer to the documentation of the options you are using to deduce to know the right state shape.</p>
<p>The <em>updater</em> function must be <em>pure</em>: given the same params, it must produce the same result. No side effects here. Forget them.</p>
<p>As a shortcut, you can also set the <em>updater</em> to the name of any action present in the action bag: the action will be invoked with the effect result as a parameter and will be delegated to update the state</p>
<h3><a class="anchor" aria-hidden="true" id="effectcaller"></a><a href="#effectcaller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>effectCaller</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">type</span> Effect = <span class="hljs-built_in">Function</span>&lt;<span class="hljs-built_in">Promise</span> | Observable&gt;
effectCaller: <span class="hljs-literal">false</span> | 
              rj.configured() | 
              <span class="hljs-function">(<span class="hljs-params">effect: Effect, ...params: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">Promise</span> | Observable
</code></pre>
<p>This setting is used to hook into the process of launching the effect, and can be used to alter its params or to add some more of them. The first argument is the <code>effect</code> to be called, and the subsequent arguments are the arguments the user sent in the action associated to the mutation. You can do everything you need here, the important thing is that you call the effect and return the Promise used to await for task completion, or an Rx Observable (this is useful if you are using rxJS Ajax).</p>
<p>This is an optional setting:</p>
<ul>
<li>if you don't set it, the RocketJump Object <code>effectCaller</code> is used to invoke the effect (it is inherited)</li>
<li>if you set it to <code>false</code>, the default effect caller is used (simply, the effect is called with the given arguments)</li>
<li>if you set it to <code>rj.configured()</code> the <code>effectCaller</code> is taken from the nearest <code>&lt;ConfigureRj /&gt;</code> component up in the tree</li>
<li>if you set it to a function, that function is used</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="takeeffect"></a><a href="#takeeffect" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>takeEffect</h3>
<p><code>string | [policy: string, ...arguments] | (observable: RxObservable, mapTo: action =&gt; RxObservable) =&gt; RxObservable</code></p>
<p>This setting is used to control what to do when more instances of a task are spawned concurrently. Its usage is identical to the omonimuos setting of the main RocketJump definition, so please refer to the description in the <a href="/react-rocketjump/docs/api_rj#takeEffect">rj constructor section</a></p>
<h3><a class="anchor" aria-hidden="true" id="reducer"></a><a href="#reducer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reducer</h3>
<p><code>(state: Object, action: Object) =&gt; Object</code></p>
<p>This setting can be used to give a mutation some state, for instance to track if it is running or not, or to read errors.</p>
<p>Shaping the state here is up to you, there is no default state</p>
<p>The actions that this reducer is expected to recognize are:</p>
<ul>
<li><em>INIT</em>, dispatched when the state is mounted</li>
<li><em>RUN</em>, dispatched when a run of the mutation is scheduled</li>
<li><em>PENDING</em>, dispateched when a run of the mutation starts</li>
<li><em>SUCCESS</em>, dispatched when a run of the mutation resolves</li>
<li><em>FAILURE</em>, dispatched when a run of the mutation rejects with some error</li>
</ul>
<p>Their shape is the following:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> { INIT, RUN, PENDING, SUCCESS, FAILURE } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-rocketjump"</span>

{
  <span class="hljs-attr">type</span>: INIT
}

{
  <span class="hljs-attr">type</span>: RUN,
  <span class="hljs-attr">payload</span>: {
    params,         <span class="hljs-comment">// the params your side effect was invoked with</span>
  }
  meta: {
    params          <span class="hljs-comment">// the params your side effect was invoked with</span>
  },
}

{
  <span class="hljs-attr">type</span>: PENDING,
  <span class="hljs-attr">meta</span>: {
    params,         <span class="hljs-comment">// the params your side effect was invoked with</span>
  },
}

{
  <span class="hljs-attr">type</span>: SUCCESS,
  <span class="hljs-attr">meta</span>: {
    params,
  },
  <span class="hljs-attr">payload</span>: {
    data,           <span class="hljs-comment">// the result of your mutation side effect</span>
    params,         <span class="hljs-comment">// the params your side effect was invoked with</span>
  }
}

{
  <span class="hljs-attr">type</span>: FAILURE,
  <span class="hljs-attr">meta</span>: {
    params,         <span class="hljs-comment">// the params your side effect was invoked with</span>
  },
  payload           <span class="hljs-comment">// the rejection value of your side effect</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="mutation-wrappers"></a><a href="#mutation-wrappers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mutation wrappers</h2>
<p>React RocketJump provides some utilities to setup sensible defaults on <em>takeEffect</em> and <em>reducer</em> for the most common cases</p>
<h3><a class="anchor" aria-hidden="true" id="single-mutation"></a><a href="#single-mutation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Single mutation</h3>
<p>This options set is thought for mutations that have no overlapping or concurrent runs. A common use case, for instance, is a form submission.</p>
<p>This preset sets <em>effectCaller</em> to <em>exhaust</em> and configures the reducer to mantain a state with the following shape:</p>
<pre><code class="hljs css language-js">{
    <span class="hljs-attr">pending</span>: bool,  <span class="hljs-comment">// is the mutation running?</span>
    error: any      <span class="hljs-comment">// rejection value of last failing run</span>
}
</code></pre>
<p>You can apply it to a mutation like this</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> TodosStateRj = rj({
  <span class="hljs-attr">effect</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> fetch(<span class="hljs-string">`/user`</span>).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json()),
  <span class="hljs-attr">mutations</span>: {
    <span class="hljs-attr">updateUserProfile</span>: rj.mutation.single({
      <span class="hljs-comment">// takeEffect and reducer are injected for you</span>
      effect: <span class="hljs-function"><span class="hljs-params">newProfile</span> =&gt;</span> fetch(<span class="hljs-string">`/user`</span>, {
         <span class="hljs-attr">method</span>: <span class="hljs-string">'PATCH'</span>,
         <span class="hljs-attr">body</span>: newProfile,
      }).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json()),
      <span class="hljs-attr">updater</span>: <span class="hljs-string">'updateData'</span>,
    })
  },
})
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="multiple-mutation"></a><a href="#multiple-mutation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multiple mutation</h3>
<p>This option set is designed for mutations that have multiple concurrent runs. Furthermore, it applies a grouping logic: runs belonging to the same group cannot be parallel and only one run per group can be active at a time.</p>
<p>The application of this preset requires the user to define a key derivation function, that is a function that computes a key from the params fed into the mutation call. Runs with the same key are inserted in the same group, with the logic stated above.</p>
<p>This preset sets <em>effectCaller</em> to <em>groupByExhaust</em>, and the reducer is configured to mantain a state with the following shape:</p>
<pre><code class="hljs css language-ts">{
  pendings: {
    [key]: <span class="hljs-literal">true</span> | <span class="hljs-literal">undefined</span>,
  },
  errors: {
    [key]: <span class="hljs-built_in">any</span> | <span class="hljs-literal">undefined</span>
  }
}
</code></pre>
<p>You can apply it to a mutation like this</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> TodosState = rj(
  rjPlainList(), 
    {
    <span class="hljs-attr">mutations</span>: {
      <span class="hljs-attr">toggleTodo</span>: rj.mutation.multi(
        <span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.id,     <span class="hljs-comment">// Key derivation function</span>
        {
          <span class="hljs-attr">effect</span>: <span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> fetch(<span class="hljs-string">`/todos/<span class="hljs-subst">${todo.id}</span>`</span>, {
             <span class="hljs-attr">method</span>: <span class="hljs-string">'PATCH'</span>,
             <span class="hljs-attr">body</span>: { <span class="hljs-attr">done</span>: !todo.done }
          }).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json()),
          <span class="hljs-attr">updater</span>: <span class="hljs-string">'updateItem'</span>
        }
      )
    },
    <span class="hljs-attr">effect</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> fetch(<span class="hljs-string">`/todos`</span>).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json()),
  }
)  
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="using-the-mutations-state"></a><a href="#using-the-mutations-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using the mutations state</h2>
<blockquote>
<p>Mutation state is defined only for mutations with a <em>reducer</em> configured
If you use rj.mutation.single or rj.mutation.multi a <em>reducer</em> is automatically provided, otherwise you need to define your own</p>
</blockquote>
<p>When you configure mutations in the context of a RocketJump Object, any instance of it will have the state sliced in two parts</p>
<ul>
<li>a slice holds the main state (i.e. the state you would have had if you did not define mutations)</li>
<li>the other slice holds a state object for any defined mutation</li>
</ul>
<p>Selectors have been put in place to deal with this situation</p>
<ul>
<li><em>getRoot</em> extracts the main state from the (opaque) state object</li>
<li><em>getMutation</em> extracts the state of a mutation</li>
</ul>
<p>You can use them like in these examples</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> [state, actions] = useRunRj(RjObject, (state, { getRoot, getData }) =&gt; ({
  <span class="hljs-attr">mainState</span>: getData(getRoot(state)),
}))
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> [state, actions] = useRunRj(MaRjObject, (state, { getMutation }) =&gt; ({
  <span class="hljs-attr">pending</span>: getMutation(state, <span class="hljs-string">'mutationName.path.to.your.state.as.deep.as.you.want'</span>),
}))
</code></pre>
<p>Furthermore, you can refer to mutations' states in <em>computed</em> section using a special selector <code>@mutation</code>, like the following example:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> MaTodosState = rj({
  <span class="hljs-attr">mutations</span>: {
    <span class="hljs-attr">updateUserProfile</span>: rj.mutation.single({
      <span class="hljs-attr">effect</span>: <span class="hljs-function"><span class="hljs-params">newProfile</span> =&gt;</span> fetch(<span class="hljs-string">`/user`</span>, {
         <span class="hljs-attr">method</span>: <span class="hljs-string">'PATCH'</span>,
         <span class="hljs-attr">body</span>: newProfile,
      }).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json()),
      <span class="hljs-attr">updater</span>: <span class="hljs-string">'updateData'</span>,
    })
  },
  <span class="hljs-attr">effect</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> fetch(<span class="hljs-string">`/user`</span>).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json()),
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-comment">// Select data from your root state</span>
    todos: <span class="hljs-string">'getData'</span>, 
    <span class="hljs-comment">// Select data from a mutation state (`updateUserProfile`) is the name of the mutation</span>
    <span class="hljs-comment">// followed by the path, relative to mutations state root, of the data you want to extract</span>
    updatingProfile: <span class="hljs-string">'@mutation.updateUserProfile.pending'</span>,
  },
})
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/react-rocketjump/docs/api_composition"><span class="arrow-prev">← </span><span>Composition</span></a><a class="docs-next button" href="/react-rocketjump/docs/connect_generalities"><span>Generalities</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#generalities">Generalities</a></li><li><a href="#defining-mutations">Defining mutations</a><ul class="toc-headings"><li><a href="#effect">effect</a></li><li><a href="#updater">updater</a></li><li><a href="#effectcaller">effectCaller</a></li><li><a href="#takeeffect">takeEffect</a></li><li><a href="#reducer">reducer</a></li></ul></li><li><a href="#mutation-wrappers">Mutation wrappers</a><ul class="toc-headings"><li><a href="#single-mutation">Single mutation</a></li><li><a href="#multiple-mutation">Multiple mutation</a></li></ul></li><li><a href="#using-the-mutations-state">Using the mutations state</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/react-rocketjump/" class="nav-home"></a><div><h5>Docs</h5><a href="/react-rocketjump/docs/quickstart">Getting Started</a><a href="/react-rocketjump/docs/api_rj">API Reference</a><a href="/react-rocketjump/docs/plugin_all">Plugins</a></div><div><h5>More</h5><a href="https://github.com/inmagik/react-rocketjump">GitHub</a><a class="github-button" href="https://github.com/inmagik/react-rocketjump" data-icon="octicon-star" data-count-href="/inmagik/react-rocketjump/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://inmagik.com" target="_blank" rel="noreferrer noopener" class="fbOpenSource inmagikOpenSource"><img src="/react-rocketjump/img/inmagik_logo_circle1.png" alt="InMagik Logo"/></a><section class="copyright">Copyright © 2019 INMAGIK srl</section></footer></div></body></html>